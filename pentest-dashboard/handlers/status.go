package handlers

import (
	"net/http"
	"pentest-dashboard/models"

	"github.com/gin-gonic/gin"
)

var currentStatus = models.Status{
	Status:      "Draft",
	Description: "Bugcrowd is setting up your engagement",
	Date:        "02 Aug, 2023",
}

func GetStatus(c *gin.Context) {
	c.JSON(http.StatusOK, currentStatus)
}

func UpdateStatus(c *gin.Context) {
	var newStatus models.Status
	if err := c.ShouldBindJSON(&newStatus); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
		return
	}

	currentStatus = newStatus
	models.ProgressValue.Progress = calculateProgress(newStatus.Status)

	c.JSON(http.StatusOK, gin.H{"message": "Status updated successfully", "progress": models.ProgressValue.Progress})
}

func calculateProgress(status string) string {
	switch status {
	case "Draft":
		return "10%"
	case "Launching":
		return "30%"
	case "In progress":
		return "80%"
	case "Finalizing":
		return "90%"
	case "Completed":
		return "100%"
	default:
		return "0%"
	}
}
